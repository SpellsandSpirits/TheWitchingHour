<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>18</title>
<style>
  :root { color-scheme: dark; }
  html, body {
    margin: 0; height: 100%;
    background: #0b0b0d; color: #eae9ef;
    font: 16px/1.5 ui-sans-serif, system-ui, -apple-system, "Segoe UI",
          Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
  }
  .wrap { max-width: 720px; margin: 10vh auto; padding: 0 20px; text-align: center; }

  .toplabel {
    font-size: 12px; text-transform: uppercase; letter-spacing: .18em;
    color:#9b98a7; opacity:.8; margin-bottom: 15px;
  }

  .card {
    max-width: 560px; width: 100%;
    margin: 22px auto 0; padding: 28px;
    border: 1px solid #3a3847; border-radius: 16px;
    background: linear-gradient(180deg, #0b0b0d, #121217);
    box-shadow: 0 10px 40px rgba(0,0,0,.6);
  }

  /* input + hint */
  .input-wrap { margin: 0 auto 16px; }
  input[type="tel"]{
    background:#121217; border:1px solid #242432; color:#eae9ef;
    padding:12px 14px; border-radius:10px; outline:none; width:100%; max-width:220px;
    text-align:center; font-weight:600; letter-spacing:.08em;
  }
  .hint { margin-top: 8px; color:#c9c7d4; opacity:.9; font-size: 13px; letter-spacing:.06em; }

  /* lottie container shows as an “image” before play */
  .lottie-wrap{
    margin-top: 18px;
    display: grid; place-items: center;
  }
  #decoder{
    width: min(92vw, 520px);
    /* set a height for initial paint; adjust to your comp’s aspect ratio if needed */
    aspect-ratio: 1 / 1;      /* square dial by default; change if your ring is not square */
    max-height: 70vh;
  }

  .msg { margin-top: 10px; min-height:1.2em; color:#bdbdbd; }
  .msg.success { color:#f5c473; }
</style>
</head>
<body>
  <div class="wrap">
    <div class="toplabel">18</div>

    <div class="card">
      <div class="input-wrap">
        <input id="magic" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="2" autocomplete="off" aria-label="magic number">
        <div class="hint">enter the magic number</div>
      </div>

      <div class="lottie-wrap">
        <div id="decoder"></div>
      </div>

      <div id="msg" class="msg" aria-live="polite"></div>
    </div>
  </div>

  <!-- Lottie player -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js" integrity="sha512-7Sx8q7pZ0l1Eo6cGOeU7i4rT9h7mJd2zR1Zqv7Eo1UttfC3L5l5B8f6xsy8Y5cI7lmv2QmQqKxw3iJw2dC8X8A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    // --- knobs ---
    const TARGET_VALUE = '23';
    const START_FRAME = 0;
    const END_FRAME   = 126;  // inclusive target to hold on
    const JSON_PATH   = './decoder_ring.json';

    const input = document.getElementById('magic');
    const msg   = document.getElementById('msg');

    // Load Lottie paused, show frame 0 as a still
    const anim = lottie.loadAnimation({
      container: document.getElementById('decoder'),
      renderer: 'svg',
      loop: false,
      autoplay: false,
      path: JSON_PATH
    });

    // Once JSON loads, ensure we’re parked on frame 0 (or your chosen start)
    anim.addEventListener('DOMLoaded', () => {
      try { anim.goToAndStop(START_FRAME, true); } catch(e) {}
    });

    // When it finishes, freeze on END_FRAME for good measure
    anim.addEventListener('complete', () => {
      try { anim.goToAndStop(END_FRAME, true); } catch(e) {}
      msg.textContent = ''; // keep it clean after success
    });

    // Helper: normalize digits
    const digitsOnly = s => (s || '').replace(/\D+/g,'');
    const lockInput = () => { input.disabled = true; input.blur(); };

    // Trigger on typing (no button)
    input.addEventListener('input', () => {
      const val = digitsOnly(input.value);
      if (val.length > 2) input.value = val.slice(0,2);
      if (val === TARGET_VALUE) {
        // Play exactly 0 -> 126 once, then hold on 126
        try {
          anim.goToAndStop(START_FRAME, true);
          anim.playSegments([START_FRAME, END_FRAME], true);
        } catch(e) {
          // fallback: just play and hope comp length matches
          anim.play();
        }
        lockInput();
        msg.textContent = '…the mechanism awakens.';
        msg.classList.add('success');
      } else if (val.length === 2) {
        // wrong 2-digit entry feedback (subtle)
        msg.textContent = '…nothing happens.';
        msg.classList.remove('success');
      } else {
        msg.textContent = '';
        msg.classList.remove('success');
      }
    });

    // autofocus after paint
    setTimeout(() => input && input.focus(), 80);
  </script>
</body>
</html>
