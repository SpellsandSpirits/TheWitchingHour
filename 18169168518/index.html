<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>18</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    /* keep it super minimal to match your other pages */
    :root { --bg:#0f0f13; --fg:#eaeaea; --border:#333; }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;}
    .page{max-width:560px;margin:20px auto;padding:0 16px;text-align:center}
    .badge{font-weight:700; letter-spacing:.5px; opacity:.9; font-size:16px; margin:0 0 8px 0;}
    .prompt{margin:8px 0 6px 0; font-size:15px; opacity:.85;}
    #magicInput{
      width:200px; font-size:18px; text-align:center; padding:10px 12px;
      border-radius:10px; border:1px solid var(--border); background:#17171c; color:var(--fg);
      outline:none; margin:0 auto 12px auto; display:block;
    }
    #cipherContainer{ width:92vw; max-width:520px; aspect-ratio:1/1; margin:0 auto; }
    #cipherContainer svg{ width:100%; height:100%; display:block; background:transparent; }
    .shake{ animation:shake .28s ease; }
    @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}50%{transform:translateX(6px)}75%{transform:translateX(-3px)}}
    noscript{display:block;margin:12px auto;max-width:520px;padding:10px;border:1px solid #6a2a2a;background:#3a1d1d;color:#fff2f2;border-radius:8px}
  </style>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
</head>
<body>
  <div class="page">
    <!-- little number at the very top (plain, like your other pages) -->
    <div class="badge">18</div>

    <!-- input ABOVE the animation -->
    <div class="prompt">Enter the magic number.</div>
    <input id="magicInput" inputmode="numeric" pattern="[0-9]*" placeholder="Enter numberâ€¦"
           autocomplete="one-time-code" aria-label="Enter the magic number">

    <!-- Lottie container (transparent, no gradients) -->
    <div id="cipherContainer" aria-label="Decoder ring animation"></div>

    <noscript>This page requires JavaScript to reveal the cipher.</noscript>
  </div>

  <script>
    (function(){
      const container = document.getElementById('cipherContainer');
      const input = document.getElementById('magicInput');

      const anim = lottie.loadAnimation({
        container,
        renderer: 'svg',
        loop: false,
        autoplay: false,
        path: 'decoder_ring.json' // keep this file next to this HTML
      });

      // Show first (misaligned) frame as soon as data is ready
      const showFirst = () => anim.goToAndStop(0, true);
      anim.addEventListener('data_ready', showFirst);

      let unlocked = false;
      const LAST_FRAME = 126; // your final aligned frame

      function triggerUnlock(){
        if (unlocked) return;
        unlocked = true;
        input.value = '23';
        input.disabled = true;
        input.blur();

        anim.playSegments([0, LAST_FRAME], true);
        const onComplete = () => {
          anim.goToAndStop(LAST_FRAME, true); // hold forever on final frame
          anim.removeEventListener('complete', onComplete);
          // optional next step: redirect or reveal
          // setTimeout(()=>location.href='next.html', 800);
        };
        anim.addEventListener('complete', onComplete);
      }

      // As-you-type (no submit button)
      input.addEventListener('input', () => {
        input.value = input.value.replace(/\D+/g,''); // digits only
        if (input.value === '23') {
          triggerUnlock();
        } else if (input.value.length >= 2 && !unlocked) {
          input.classList.remove('shake'); void input.offsetWidth; input.classList.add('shake');
        }
      });

      // Optional: autofocus
      window.addEventListener('load', () => {
        setTimeout(()=>{ if (!unlocked) input.focus({preventScroll:true}); }, 50);
      });
    })();
  </script>
</body>
</html>
