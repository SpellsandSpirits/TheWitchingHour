<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>01</title>
<style>
  :root { color-scheme: dark; }
  html, body {
    margin: 0; height: 100%;
    background: #0b0b0d; color: #eae9ef;
    font: 16px/1.5 ui-sans-serif, system-ui, -apple-system, "Segoe UI",
          Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
  }
  .wrap {
    max-width: 720px;
    margin: 10vh auto;
    padding: 0 20px;
    text-align: center;
  }
  .toplabel {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.18em;
    color: #9b98a7;
    opacity: 0.8;
    margin-bottom: 10px;
  }
  .q {
    font-size: clamp(22px, 4.6vw, 34px);
    font-weight: 700;
    margin: 8px 0 18px;
  }
  form { margin: 8px auto 6px; }
  input[type="text"]{
    background:#121217; border:1px solid #242432; color:#eae9ef;
    padding:12px 14px; border-radius:10px; outline:none;
    width:100%; max-width:360px;
  }
  input::placeholder{ color:#8a8996; }
  button{
    background:#2a2834; border:1px solid #3a3847; color:#eae9ef;
    padding:10px 14px; border-radius:10px; cursor:pointer;
    text-transform:lowercase; margin-top:10px; width:100%; max-width:360px;
  }
  button:hover{ background:#343244; }

  .result { margin-top: 32px; }

  .msg{
    font-size:14px; margin-bottom:8px; /* tighter gap above rune */
    color:#c25b5b; /* default = error red */
    opacity: 0;          /* start hidden; will fade in on success */
    transition: opacity 1s ease, color .3s ease;
  }
  .msg.success { color:#f5c473; } /* gold/amber */
  .msg.show    { opacity: 1; }    /* fade-in toggle */

  .sigil{
    display:none; opacity:0;
    margin:6px auto 0;  /* tighter gap below message */
    max-width:min(80vw,520px);
    filter: drop-shadow(0 0 20px rgba(255, 0, 80, 0.25));
    transition: opacity 1s ease;  /* 1 second fade */
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="toplabel" id="toplabel">01</div>

  <div class="q">Q. What is the name of the hand in the Addams Family?</div>

  <form id="puzzleForm" autocomplete="off">
    <input id="answerInput" type="text" placeholder="whisper the counterspell" aria-label="answer" />
    <button type="submit">submit</button>
  </form>

  <div class="result">
    <div class="msg" id="message"></div>
    <img id="sigil" class="sigil" alt="sigil unlocked" />
  </div>
</div>

<script>
  // --- per-page settings ---
  const TOP_LABEL = "01";
  const RUNE_SRC = "./Rune_Othala.png";
  document.getElementById("toplabel").textContent = TOP_LABEL;

  // Lightweight obfuscation (normalize->reverse->XOR->join)
  const KEY = [7,13,31];
  const ACCEPTED_OBF = [
    "96,99,118,111,121",                 // obf("thing")
    "96,99,118,111,121,122,111,121"      // obf("thething")
  ];

  function normalize(s){
    return (s||"").toLowerCase().replace(/[^a-z0-9]+/g,"");
  }
  function obf(s){
    const n = normalize(s);
    const rev = n.split("").reverse();
    const codes = rev.map((ch,i)=> ch.charCodeAt(0) ^ KEY[i % KEY.length]);
    return codes.join(",");
  }

  const form = document.getElementById("puzzleForm");
  const input = document.getElementById("answerInput");
  const msg   = document.getElementById("message");
  const sigil = document.getElementById("sigil");

  function showError(text){
    msg.textContent = text;
    msg.classList.remove("success","show"); // show immediately without fade
    // keep message visible (no fade) on errors:
    msg.style.opacity = 1;
  }

  form.addEventListener("submit",(e)=>{
    e.preventDefault();
    const candidate = input.value;
    if(!candidate){ showError("enter an answer."); return; }

    const token = obf(candidate);
    const ok = ACCEPTED_OBF.includes(token);

    if(ok){
      // reset state to allow a clean fade
      msg.classList.remove("success","show");
      msg.style.opacity = 0;
      msg.textContent = "You have discovered a rune.";

      // next frame: add classes to trigger 1s fade-in
      requestAnimationFrame(()=>{
        msg.classList.add("success","show"); // gold color + fade-in
      });

      sigil.src = RUNE_SRC;
      sigil.style.display = "block";
      requestAnimationFrame(()=> { sigil.style.opacity = "1"; }); // 1s fade

      input.disabled = true;
    }else{
      showError("try again.");
    }
  });

  setTimeout(()=> input && input.focus(), 50);
</script>
</body>
</html>
