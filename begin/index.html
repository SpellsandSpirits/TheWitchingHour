<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Begin</title>
<style>
  :root { color-scheme: dark; }
  html, body {
    margin: 0; height: 100%;
    background: #0b0b0d; color: #eae9ef;
    font: 16px/1.5 ui-sans-serif, system-ui, -apple-system, "Segoe UI",
          Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
  }
  .wrap { max-width: 720px; margin: 8vh auto; padding: 0 20px; text-align: center; }
  h1 {
    font-size: clamp(26px, 6vw, 40px);
    font-weight: 700;
    margin-bottom: 10px;
    letter-spacing: .03em;
  }
  p { color:#c9c7d4; line-height:1.6; margin:12px 0; }

  form { margin-top: 32px; }

  label {
    display:block;
    margin-top:18px;
    font-size:14px;
    text-transform:uppercase;
    letter-spacing:.1em;
    color:#9b98a7;
  }

  input[type="text"]{
    background:#121217;
    border:1px solid #242432;
    color:#eae9ef;
    padding:10px 14px;
    border-radius:10px;
    outline:none;
    width:100%;
    max-width:360px;
    margin-top:6px;
  }

  button{
    background:#2a2834;
    border:1px solid #3a3847;
    color:#eae9ef;
    padding:12px 18px;
    border-radius:10px;
    cursor:pointer;
    text-transform:lowercase;
    margin-top:24px;
    width:100%;
    max-width:360px;
  }
  button:hover{ background:#343244; }

  .msg { margin-top:10px; font-size:14px; color:#f5c473; opacity:0; transition:opacity .6s ease; }
  .msg.show { opacity:1; }
</style>
</head>
<body>
<div class="wrap">
  <h1>The Witching Hour</h1>

  <p>A shadow lingers over this house…<br>
  A curse cast long ago by the Witch of Little Turtle Hollow.<br><br>
  Only those clever enough to outsmart her may end it.<br>
  Will you accept the task of breaking the Witch’s curse?</p>

  <p>Form your coven below (up to four names).<br>
  The brave may walk this path alone.<br><br>
  Choose a direction — north for courage, south for wit,<br>
  east for intuition, west for strength.</p>

  <form id="beginForm" autocomplete="off">
    <label for="north">North</label>
    <input id="north" name="north" type="text" placeholder="Name" />
    <label for="east">East</label>
    <input id="east" name="east" type="text" placeholder="Name" />
    <label for="south">South</label>
    <input id="south" name="south" type="text" placeholder="Name" />
    <label for="west">West</label>
    <input id="west" name="west" type="text" placeholder="Name" />

    <button type="submit">accept the task</button>
    <div id="msg" class="msg">…the pact is recorded.</div>
  </form>
</div>

<script>
const SUBMIT_ENDPOINT = 'https://script.google.com/macros/s/AKfycbymoSk6OlJ5Bk3oFLwejhIlXEEU_eax-Rjpp7BU1UEaHkJAjYEkHVmo7bicgh96Q5Cu/exec';
const NEXT_PAGE = 'https://spellsandspirits.github.io/TheWitchingHour/';
const REDIRECT_DELAY_MS = 2500;  // total time before redirect (~2.5s)

const form = document.getElementById('beginForm');
const msg  = document.getElementById('msg');

function clean(s){ return (s||'').trim(); }
function payloadFromForm() {
  const north = clean(document.getElementById('north').value);
  const east  = clean(document.getElementById('east').value);
  const south = clean(document.getElementById('south').value);
  const west  = clean(document.getElementById('west').value);
  const names = [north, east, south, west].filter(Boolean);
  return {
    team: { north, east, south, west, names, size: names.length },
    meta: { when_iso: new Date().toISOString(),
            tz: Intl.DateTimeFormat().resolvedOptions().timeZone || 'unknown',
            ua: navigator.userAgent }
  };
}

// Fire-and-forget POST (text/plain -> avoids CORS preflight)
function sendFireAndForget(endpoint, data){
  try {
    fetch(endpoint, {
      method: 'POST',
      body: JSON.stringify(data), // no Content-Type header on purpose
      keepalive: true,
      mode: 'cors',
      cache: 'no-store'
    }).catch(()=>{});
  } catch (_) {}
}

form.addEventListener('submit', (e)=>{
  e.preventDefault();

  const data = payloadFromForm();
  if (data.team.size === 0) {
    msg.textContent = 'Add at least one name to form your coven.';
    msg.classList.remove('success'); 
    msg.classList.add('error','show');
    return;
  }

  // Feedback
  msg.textContent = '…the pact is recorded. please wait…';
  msg.classList.remove('error');
  msg.classList.add('success','show');
  // smooth fade-out before redirect
  msg.style.transition = 'opacity 1s ease';
  msg.style.opacity = '1';

  // Prevent double-submits
  [...form.elements].forEach(el => el.disabled = true);

  // Send data (don’t await)
  sendFireAndForget(SUBMIT_ENDPOINT, data);

  // Fade the message out ~1s before redirect
  const fadeMs = Math.max(0, REDIRECT_DELAY_MS - 1000);
  setTimeout(()=>{ msg.style.opacity = '0'; }, fadeMs);

  // Redirect
  setTimeout(()=>{ window.location.href = NEXT_PAGE; }, REDIRECT_DELAY_MS);
});
</script>


</body>
</html>
