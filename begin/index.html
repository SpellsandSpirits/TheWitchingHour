<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Begin</title>
<style>
  :root { color-scheme: dark; }
  *,*::before,*::after { box-sizing: border-box; }
  html, body {
    margin: 0; height: 100%;
    /* Full-screen background (1080x1920 is perfect) */
    background: #0b0b0d url("./Beginbkg.png") no-repeat center center fixed;
    background-size: cover;
    color: #eae9ef;
    font: 16px/1.55 ui-sans-serif, system-ui, -apple-system, "Segoe UI",
          Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
  }

  .wrap { max-width: 720px; margin: 8vh auto; padding: 0 20px; text-align: center; }

  .title {
    font-size: clamp(26px, 5.6vw, 42px);
    font-weight: 800;
    letter-spacing: .02em;
    margin: 0 0 12px;
    line-height: 1.15;
    text-shadow: 0 2px 14px rgba(0,0,0,.35);
  }
  .intro {
    font-size: clamp(14px, 2.3vw, 18px);
    color:#c9c7d4;
    line-height: 1.6;
    margin: 0 auto 18px;
    max-width: 46ch;
    text-shadow: 0 2px 10px rgba(0,0,0,.35);
  }

  .card {
    max-width: 520px; width: 100%;
    margin: 24px auto 0; padding: 24px;
    border: 1px solid #3a3847; border-radius: 16px;
    background: linear-gradient(180deg, rgba(11,11,13,.90), rgba(18,18,23,.90));
    backdrop-filter: blur(2px);
    box-shadow: 0 10px 40px rgba(0,0,0,.6);
    text-align: center;
  }

  .subtitle {
    margin: 0 0 8px;
    font-weight: 700;
    font-size: clamp(16px, 3vw, 20px);
  }
  .hint {
    color:#9b98a7; opacity:.95; font-size: 13px; letter-spacing:.04em;
    margin: 0 0 14px;
  }

  .grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    margin: 12px 0 6px;
  }
  @media (max-width: 430px) {
    .grid { grid-template-columns: 1fr; }
  }

  label {
    display:block; text-align:left; font-size:12px; letter-spacing:.12em;
    text-transform: uppercase; color:#9b98a7; margin: 0 0 6px;
  }
  .field { text-align:left; }

  input[type="text"]{
    background:#121217; border:1px solid #242432; color:#eae9ef;
    padding:12px 14px; border-radius:10px; outline:none; width:100%;
  }
  input::placeholder{ color:#8a8996; }

  .actions { margin-top: 18px; }
  button{
    background:#2a2834; border:1px solid #3a3847; color:#eae9ef;
    padding:12px 16px; border-radius:10px; cursor:pointer; width:100%;
    max-width:260px; font-weight:700; letter-spacing:.06em; text-transform: lowercase;
  }
  button:hover{ background:#343244; }

  .msg {
    margin-top: 12px; min-height:1.2em; font-size:14px;
    color:#f5c473; opacity:0; transition: opacity 1s ease;
    text-shadow: 0 2px 10px rgba(0,0,0,.35);
  }
  .msg.show { opacity: 1; }
  .msg.error { color:#c25b5b; }

  /* tiny spinner for feedback */
  .msg.success::after{
    content:"";
    display:inline-block;
    width:12px;height:12px;margin-left:8px;
    border-radius:50%;
    border:2px solid currentColor;
    border-right-color: transparent;
    animation: spin .8s linear infinite;
    vertical-align:-2px;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>
  <div class="wrap">
    <h1 class="title">The Witching Hour</h1>
    <p class="intro">
      A shadow lingers over this house… A curse cast long ago by the Witch of Little Turtle Hollow.
      Only those clever enough to outsmart her may end it.
      Will you accept the task of breaking the Witch’s curse?
    </p>

    <div class="card">
      <h2 class="subtitle">Form your coven below (up to four names).</h2>
      <p class="hint">The brave may walk this path alone. Choose a direction — north for courage, south for wit, east for intuition, west for strength.</p>

      <form id="beginForm" autocomplete="off" novalidate>
        <div class="grid">
          <div class="field">
            <label for="north">North</label>
            <input id="north" name="north" type="text" placeholder="Name" />
          </div>
          <div class="field">
            <label for="east">East</label>
            <input id="east" name="east" type="text" placeholder="Name" />
          </div>
          <div class="field">
            <label for="south">South</label>
            <input id="south" name="south" type="text" placeholder="Name" />
          </div>
          <div class="field">
            <label for="west">West</label>
            <input id="west" name="west" type="text" placeholder="Name" />
          </div>
        </div>

        <div class="actions">
          <button type="submit">accept the task</button>
        </div>
        <div id="msg" class="msg" aria-live="polite"></div>
      </form>
    </div>
  </div>

<script>
/* ====== Config ====== */
const SUBMIT_ENDPOINT = 'https://script.google.com/macros/s/AKfycbymoSk6OlJ5Bk3oFLwejhIlXEEU_eax-Rjpp7BU1UEaHkJAjYEkHVmo7bicgh96Q5Cu/exec';
const NEXT_PAGE = 'https://spellsandspirits.github.io/TheWitchingHour/';
const REDIRECT_DELAY_MS = 2500;  // ~2.5 seconds total

const form = document.getElementById('beginForm');
const msg  = document.getElementById('msg');

function clean(s){ return (s||'').trim(); }
function payloadFromForm() {
  const north = clean(document.getElementById('north').value);
  const east  = clean(document.getElementById('east').value);
  const south = clean(document.getElementById('south').value);
  const west  = clean(document.getElementById('west').value);
  const names = [north, east, south, west].filter(Boolean);
  return {
    team: { north, east, south, west, names, size: names.length },
    meta: { when_iso: new Date().toISOString(),
            tz: Intl.DateTimeFormat().resolvedOptions().timeZone || 'unknown',
            ua: navigator.userAgent }
  };
}

// Fire-and-forget POST as text/plain JSON (no CORS preflight)
function sendFireAndForget(endpoint, data){
  try {
    fetch(endpoint, {
      method: 'POST',
      body: JSON.stringify(data), // intentionally no Content-Type header
      keepalive: true,
      mode: 'cors',
      cache: 'no-store'
    }).catch(()=>{});
  } catch (_) {}
}

form.addEventListener('submit', (e)=>{
  e.preventDefault();
  const data = payloadFromForm();

  if (data.team.size === 0) {
    msg.textContent = 'Add at least one name to form your coven.';
    msg.classList.remove('success'); msg.classList.add('error','show');
    return;
  }

  // Friendly feedback
  msg.textContent = '…the pact is recorded. please wait…';
  msg.classList.remove('error'); msg.classList.add('success','show');
  msg.style.transition = 'opacity 1s ease';
  msg.style.opacity = '1';

  // prevent double-submits
  [...form.elements].forEach(el => el.disabled = true);

  // send without waiting
  sendFireAndForget(SUBMIT_ENDPOINT, data);

  // fade message out ~1s before redirect
  const fadeMs = Math.max(0, REDIRECT_DELAY_MS - 1000);
  setTimeout(()=>{ msg.style.opacity = '0'; }, fadeMs);

  // redirect to main site
  setTimeout(()=>{ window.location.href = NEXT_PAGE; }, REDIRECT_DELAY_MS);
});
</script>
</body>
</html>
