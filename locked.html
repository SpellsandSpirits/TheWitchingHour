<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>No.</title>
<style>
  /* Reset & mobile safety */
  * { box-sizing: border-box; }
  html, body { height: 100%; }
  html, body { margin: 0; overflow-x: hidden; }
  :root { color-scheme: dark; }

  body {
    display: grid;
    min-height: 100dvh;
    place-items: center;
    background: #0b0b0d;
    color: #eaeaea;
    font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    padding: env(safe-area-inset-top) 12px env(safe-area-inset-bottom);
  }

  .card {
    width: min(92svw, 520px);
    max-width: 520px;
    background: #141418;
    border: 1px solid #26262b;
    border-radius: 16px;
    padding: 22px;
    margin-inline: auto;
    box-shadow: 0 8px 28px rgba(0,0,0,.35);
    text-align: center;
  }

  h1 {
    margin: 2px 0 8px;
    font-size: clamp(1.1rem, 2.8vw, 1.35rem);
    letter-spacing: 0.2px;
  }

  .time {
    font-variant-numeric: tabular-nums;
    font-size: clamp(1.6rem, 6vw, 2.2rem);
    letter-spacing: .03em;
    margin: .25rem 0 .75rem;
  }

  .sub { opacity: .82; font-size: .95rem; }

  .btn {
    display: inline-block;
    margin-top: 10px;
    border: 1px solid #2c2c33;
    padding: 10px 14px;
    border-radius: 10px;
    text-decoration: none;
    color: #eaeaea;
  }

  @media (max-width: 360px) {
    .card { width: min(94svw, 520px); padding: 18px; }
  }
</style>
</head>
<body>
  <div class="card">
    <h1>The Portal is Locked. ðŸ”’</h1>
    <div class="time" id="count">--:--:--</div>
    <div class="sub">Test your fate at <strong>8:00 PM</strong>.</div>
    <a class="btn" href="https://spellsandspirits.github.io/TheWitchingHour/begin/">register</a>
    <noscript><p class="sub">Enable JavaScript to see the countdown.</p></noscript>
  </div>

<script>
(function () {
  // Accepts ?until= as either milliseconds since epoch OR an ISO string.
  // Example (from your gate script): ?until=2025-10-17T20:00:00-06:00  OR  ?until=1760762400000
  const params = new URLSearchParams(location.search);
  const raw = params.get("until") || "2025-10-17T20:00:00-06:00";

  function parseStart(v) {
    const n = Number(v);
    if (Number.isFinite(n) && n > 0) return n;      // numeric ms timestamp
    let t = Date.parse(v);
    if (!Number.isFinite(t)) {
      // Safari fallback: remove colon in timezone, e.g. -06:00 -> -0600
      t = Date.parse(String(v).replace(/([+-]\d{2}):?(\d{2})$/, "$1$2"));
    }
    return t;
  }

  const start = parseStart(raw);
  const el = document.getElementById("count");

  function render(diffMs) {
    const s = Math.max(0, Math.floor(diffMs / 1000));
    const dd = Math.floor(s / 86400);
    const hh = Math.floor((s % 86400) / 3600);
    const mm = Math.floor((s % 3600) / 60);
    const ss = s % 60;
    el.textContent = dd > 0
      ? `${dd}d ${String(hh).padStart(2,"0")}:${String(mm).padStart(2,"0")}:${String(ss).padStart(2,"0")}`
      : `${String(hh + dd*24).padStart(2,"0")}:${String(mm).padStart(2,"0")}:${String(ss).padStart(2,"0")}`;
  }

  function tick() {
    if (!Number.isFinite(start)) { el.textContent = "00:00:00"; return; }
    const now = Date.now();
    const diff = start - now;
    if (diff <= 0) {
      el.textContent = "00:00:00";
      // Optional: auto-redirect on unlock:
      // location.replace("https://spellsandspirits.github.io/TheWitchingHour/begin/");
      return;
    }
    render(diff);
    requestAnimationFrame(tick);
  }

  tick();
})();
</script>
</body>
</html>
